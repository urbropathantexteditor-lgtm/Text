<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live GPS Tracker</title>
<style>
  body{font-family:Arial; display:flex; flex-direction:column; align-items:center; margin:0; padding:0;}
  h2{margin:20px 0;}
  #map{width:100%; max-width:800px; height:500px; margin-bottom:20px; border-radius:15px;}
</style>
</head>
<body>
<h2>Live GPS Tracker</h2>
<div id="map"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_KEY"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDFPMf8HLMpS6DbZkdCR6T7GAm5sfz-TOw",
  authDomain: "urbrokhan-f631c.firebaseapp.com",
  databaseURL: "https://urbrokhan-f631c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "urbrokhan-f631c",
  storageBucket: "urbrokhan-f631c.appspot.com",
  messagingSenderId: "533086015351",
  appId: "1:533086015351:web:a12328fbc4906e4f5c9b72",
  measurementId: "G-TGT66KJV02"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Unique visitor ID
const visitorId = 'visitor_' + Math.floor(Math.random()*1000000);

// Device info
function getDeviceInfo() {
    const ua = navigator.userAgent;
    if(/android/i.test(ua)) return "Android";
    else if(/iPad|iPhone|iPod/.test(ua)) return "iOS";
    else if(/Windows/.test(ua)) return "Windows PC";
    else if(/Macintosh/.test(ua)) return "Mac";
    return "Unknown";
}

// Send GPS to Firebase
function sendLocation() {
    if(navigator.geolocation){
        navigator.geolocation.watchPosition(pos=>{
            const {latitude, longitude} = pos.coords;
            db.ref(`visitors/${visitorId}`).set({
                device: getDeviceInfo(),
                latitude,
                longitude,
                timestamp: new Date().toISOString()
            });
        }, err=>console.error("GPS error:", err), {enableHighAccuracy:true, maximumAge:3000, timeout:10000});
    } else {
        console.error("Geolocation not supported");
    }
}

// Initialize Google Map
let map;
const markers = {};
function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
        center: {lat:20.5937, lng:78.9629}, // India default center
        zoom:5
    });

    const ref = db.ref('visitors');
    ref.on('value', snapshot=>{
        const visitors = snapshot.val();
        for(let id in visitors){
            const v = visitors[id];
            const pos = {lat:v.latitude, lng:v.longitude};
            if(markers[id]) markers[id].setPosition(pos);
            else markers[id] = new google.maps.Marker({
                position: pos,
                map: map,
                title: `${v.device} | ${v.timestamp}`
            });
        }
    });
}

// Start GPS and Map
sendLocation();
initMap();
</script>
</body>
</html>

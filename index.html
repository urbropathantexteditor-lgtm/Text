<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phone OTP Login</title>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"></script>
<style>
  body{font-family:sans-serif;background:#0f172a;color:white;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}
  .container{background:#1f2937;padding:20px;border-radius:12px;width:90%;max-width:400px;text-align:center}
  input{width:80%;padding:10px;margin:10px 0;border-radius:8px;border:none;font-size:16px}
  button{padding:10px 20px;background:#10b981;border:none;border-radius:8px;color:white;font-size:16px;cursor:pointer}
  #recaptcha-container{margin:10px 0;}
  .success{color:#10b981;font-weight:bold;margin-top:10px}
  .phone-wrapper{display:flex;align-items:center;justify-content:center;gap:5px;}
  .country-code{padding:10px;border-radius:8px;background:#111827;color:white;font-weight:bold}
</style>
</head>
<body>

<div class="container">
  <h2>Login with Phone OTP</h2>
  <div class="phone-wrapper">
    <div class="country-code">+91</div>
    <input type="tel" id="phoneNumber" placeholder="Enter 10-digit number" maxlength="10" pattern="[0-9]{10}" inputmode="numeric">
  </div>
  <div id="recaptcha-container"></div>
  <button id="sendOTP">Send OTP</button>

  <div id="otpSection" style="display:none;">
    <input type="tel" id="otpCode" placeholder="Enter OTP" maxlength="6" inputmode="numeric"><br>
    <button id="verifyOTP">Verify OTP</button>
  </div>

  <div id="message" class="success"></div>
</div>

<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDFPMf8HLMpS6DbZkdCR6T7GAm5sfz-TOw",
    authDomain: "urbrokhan-f631c.firebaseapp.com",
    databaseURL: "https://urbrokhan-f631c-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "urbrokhan-f631c",
    storageBucket: "urbrokhan-f631c.appspot.com",
    messagingSenderId: "533086015351",
    appId: "1:533086015351:web:a12328fbc4906e4f5c9b72",
    measurementId: "G-TGT66KJV02"
  };
  
  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // Render reCAPTCHA
  window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
    size: 'normal',
    callback: () => { console.log('reCAPTCHA solved'); }
  });
  recaptchaVerifier.render();

  const sendOTP = document.getElementById('sendOTP');
  const verifyOTP = document.getElementById('verifyOTP');
  const phoneInput = document.getElementById('phoneNumber');

  let confirmationResult;

  sendOTP.addEventListener('click', () => {
    const phoneNumber = phoneInput.value.trim();
    if(phoneNumber.length !== 10 || isNaN(phoneNumber)) {
      alert('Enter a valid 10-digit Indian phone number');
      return;
    }
    auth.signInWithPhoneNumber('+91' + phoneNumber, window.recaptchaVerifier)
      .then(result => {
        confirmationResult = result;
        document.getElementById('otpSection').style.display = 'block';
        document.getElementById('message').innerText = 'OTP sent!';
      })
      .catch(error => {
        console.error(error);
        alert('Error sending OTP: ' + error.message);
      });
  });

  verifyOTP.addEventListener('click', () => {
    const otpCode = document.getElementById('otpCode').value.trim();
    if(!otpCode){ alert('Enter OTP'); return; }

    confirmationResult.confirm(otpCode)
      .then(result => {
        const user = result.user;
        document.getElementById('message').innerText = 'Login successful! Welcome, ' + user.phoneNumber;
      })
      .catch(error => {
        console.error(error);
        alert('Invalid OTP');
      });
  });
</script>

</body>
</html>

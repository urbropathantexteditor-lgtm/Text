<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ur bro pathan â€” Stylish Text Generator</title>
<style>
  :root{--card:#0b1220;--muted:#94a3b8;--accent:#10b981;--glass:#172033}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#f1f5f9;display:flex;justify-content:center;padding:18px;background:#0b0b0b}
  .app{width:100%;max-width:1100px}
  .card{background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
  textarea{width:100%;min-height:84px;padding:12px;border-radius:8px;background:var(--glass);border:none;color:white;font-size:16px;resize:vertical}
  .styles{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;max-height:60vh;overflow:auto;padding:6px}
  .style{background:var(--glass);padding:10px;border-radius:10px;cursor:pointer;text-align:center;min-height:48px;display:flex;align-items:center;justify-content:center;word-break:break-word;transition:transform .12s,background .12s}
  .style:hover{transform:translateY(-4px);background:#243343}
  .btn{background:var(--accent);color:#06201b;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:2000}
  .loginModal{background:#071025;padding:22px;border-radius:12px;text-align:center}
  .coins{font-weight:700;margin-bottom:12px;font-size:18px;color:var(--accent)}
</style>
</head>
<body>
  <div class="app" id="app">

    <!-- Coins Display -->
    <div class="coins">Coins: <span id="coinCount">6</span></div>

    <!-- Referral Card -->
    <div class="card row">
      <div style="flex:1">
        <div class="small">Your referral code:</div>
        <div style="margin-top:6px"><span id="myRef">â€”</span> <button id="copyRef" class="btn" style="display:none">Copy</button></div>
        <div class="small" id="refCount"></div>
      </div>
      <div style="flex:1">
        <div class="small">Apply referral code:</div>
        <div style="display:flex;gap:6px;margin-top:6px">
          <input id="applyRef" style="flex:1;padding:6px;border-radius:6px;border:none;background:rgba(255,255,255,0.03);color:white" placeholder="Enter referral code" />
          <button id="applyBtn" class="btn">Apply</button>
        </div>
        <div class="small" id="applyMsg" style="margin-top:4px;color:var(--muted)"></div>
      </div>
    </div>

    <!-- Text Input -->
    <div class="card">
      <div class="small" style="margin-bottom:8px">Type text below â€” click style to copy (2 coins):</div>
      <textarea id="input">Hello from ur bro pathan</textarea>
    </div>

    <!-- Styles -->
    <div class="card">
      <div class="styles" id="stylesList"></div>
    </div>
  </div>

  <!-- WhatsApp Button -->
  <a class="wa-btn" href="https://wa.me/447877486623" target="_blank" title="WhatsApp">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WA" style="width:30px;height:30px">
  </a>

  <!-- Login Overlay -->
  <div id="overlay" class="overlay">
    <div class="loginModal">
      <h3 style="margin-bottom:12px;color:white">Login Required</h3>
      <button id="overlayLogin" class="btn">Login with Google</button>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getDatabase, ref, get, set, update, runTransaction } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDFPMf8HLMpS6DbZkdCR6T7GAm5sfz-TOw",
  authDomain: "urbrokhan-f631c.firebaseapp.com",
  databaseURL: "https://urbrokhan-f631c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "urbrokhan-f631c",
  storageBucket: "urbrokhan-f631c.appspot.com",
  messagingSenderId: "533086015351",
  appId: "1:533086015351:web:a12328fbc4906e4f5c9b72"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);
const provider = new GoogleAuthProvider();

const overlay = document.getElementById('overlay');
const overlayLogin = document.getElementById('overlayLogin');
const coinCountEl = document.getElementById('coinCount');
const myRefEl = document.getElementById('myRef');
const copyRefBtn = document.getElementById('copyRef');
const refCountEl = document.getElementById('refCount');
const applyRefInput = document.getElementById('applyRef');
const applyRefBtn = document.getElementById('applyBtn');
const applyMsg = document.getElementById('applyMsg');
const inputEl = document.getElementById('input');
const stylesList = document.getElementById('stylesList');

let currentUser=null,currentUid=null,currentData=null;

function genRefCode(){ return Math.random().toString(36).substring(2,8).toUpperCase(); }

async function ensureUser(uid,email,name){
  const uref = ref(db,'users/'+uid);
  const snap = await get(uref);
  if (!snap.exists()){
    const code = genRefCode();
    await set(uref,{email,email,displayName:name,coins:6,referralCode:code,referredUsers:{},bonusAwarded:false,referredBy:null});
    await set(ref(db,'refCodes/'+code), uid);
    return {coins:6, referralCode:code};
  }
  return snap.val();
}

async function refreshUser(){
  if (!currentUid) return;
  const snap = await get(ref(db,'users/'+currentUid));
  currentData = snap.exists()? snap.val(): null;
  coinCountEl.textContent = (currentData && currentData.coins!=null)?currentData.coins:6;
  myRefEl.textContent = (currentData && currentData.referralCode)?currentData.referralCode:'â€”';
  copyRefBtn.style.display = currentData?'inline-block':'none';
  const count = currentData && currentData.referredUsers ? Object.keys(currentData.referredUsers).length : 0;
  refCountEl.textContent = count?'Referred: '+count:'';
}

overlayLogin.addEventListener('click', async ()=>{
  try{
    await signInWithPopup(auth, provider);
    overlay.style.display = 'none';
  }catch(err){ alert('Popup blocked. Allow popups and try again.'); }
});

onAuthStateChanged(auth, async user=>{
  if(user){
    currentUser=user;
    currentUid=user.uid;
    overlay.style.display='none';
    await ensureUser(user.uid,user.email,user.displayName);
    await refreshUser();
    renderStyles();
  }else{
    overlay.style.display='flex';
    coinCountEl.textContent='6';
  }
});

/* --- Referral Apply --- */
applyRefBtn.addEventListener('click', async ()=>{
  applyMsg.textContent='';
  const code = (applyRefInput.value||'').trim().toUpperCase();
  if (!code) { applyMsg.textContent='Enter code'; return; }
  if (!currentUid){ applyMsg.textContent='Login first'; return; }
  try{
    const codeSnap = await get(ref(db,'refCodes/'+code));
    if (!codeSnap.exists()){ applyMsg.textContent='Invalid code'; return; }
    const refUid = codeSnap.val();
    if(refUid===currentUid){ applyMsg.textContent='Cannot use own code'; return; }
    const mySnap = await get(ref(db,'users/'+currentUid+'/referredBy'));
    if(mySnap.exists()&&mySnap.val()){ applyMsg.textContent='Already applied'; return; }

    const refUserRef = ref(db,'users/'+refUid);
    await runTransaction(refUserRef,curr=>{
      if(curr===null) return curr;
      if(!curr.referredUsers) curr.referredUsers={};
      if(curr.referredUsers[currentUid]) return;
      curr.referredUsers[currentUid]=true;
      curr.coins=(curr.coins||0)+10;
      return curr;
    });

    await update(ref(db,'users/'+currentUid),{referredBy:refUid});
    applyMsg.textContent='Referral applied! +10 coins to referrer';
    await refreshUser();
  }catch(e){applyMsg.textContent='Failed to apply';}
});

/* --- Stylish Generator --- */
const maps={bold:{'a':'ð—®','b':'ð—¯','c':'ð—°','d':'ð—±','e':'ð—²','f':'ð—³','g':'ð—´','h':'ð—µ','i':'ð—¶','j':'ð—·','k':'ð—¸','l':'ð—¹','m':'ð—º','n':'ð—»','o':'ð—¼','p':'ð—½','q':'ð—¾','r':'ð—¿','s':'ð˜€','t':'ð˜','u':'ð˜‚','v':'ð˜ƒ','w':'ð˜„','x':'ð˜…','y':'ð˜†','z':'ð˜‡','A':'ð—”','B':'ð—•','
  'C':'ð—–','D':'ð——','E':'ð—˜','F':'ð—™','G':'ð—š','H':'ð—›','I':'ð—œ','J':'ð—','K':'ð—ž','L':'ð—Ÿ','M':'ð— ','N':'ð—¡','O':'ð—¢','P':'ð—£','Q':'ð—¤','R':'ð—¥','S':'ð—¦','T':'ð—§','U':'ð—¨','V':'ð—©','W':'ð—ª','X':'ð—«','Y':'ð—¬','Z':'ð—­'},
italic:{'a':'ð˜¢','b':'ð˜£','c':'ð˜¤','d':'ð˜¥','e':'ð˜¦','f':'ð˜§','g':'ð˜¨','h':'ð˜©','i':'ð˜ª','j':'ð˜«','k':'ð˜¬','l':'ð˜­','m':'ð˜®','n':'ð˜¯','o':'ð˜°','p':'ð˜±','q':'ð˜²','r':'ð˜³','s':'ð˜´','t':'ð˜µ','u':'ð˜¶','v':'ð˜·','w':'ð˜¸','x':'ð˜¹','y':'ð˜º','z':'ð˜»','A':'ð´','B':'ðµ','C':'ð¶','D':'ð·','E':'ð¸','F':'ð¹','G':'ðº','H':'ð»','I':'ð¼','J':'ð½','K':'ð¾','L':'ð¿','M':'ð‘€','N':'ð‘','O':'ð‘‚','P':'ð‘ƒ','Q':'ð‘„','R':'ð‘…','S':'ð‘†','T':'ð‘‡','U':'ð‘ˆ','V':'ð‘‰','W':'ð‘Š','X':'ð‘‹','Y':'ð‘Œ','Z':'ð‘'},
smallCaps:{'a':'á´€','b':'Ê™','c':'á´„','d':'á´…','e':'á´‡','f':'êœ°','g':'É¢','h':'Êœ','i':'Éª','j':'á´Š','k':'á´‹','l':'ÊŸ','m':'á´','n':'É´','o':'á´','p':'á´˜','q':'Ç«','r':'Ê€','s':'s','t':'á´›','u':'á´œ','v':'á´ ','w':'á´¡','x':'x','y':'Ê','z':'á´¢'}};

function mapChars(text,map){return text.split('').map(c=>map[c]||c).join('');}

const emojiList=['ðŸ”¥','âœ¨','ðŸ’«','ðŸ’–','ðŸŒ¸','â­','ðŸ’¥','ðŸŒŸ','â¤ï¸','ðŸ’Ž','ðŸ’€','ðŸŽ¯','ðŸŽ‰','ðŸ¥¶','âš¡','ðŸŒˆ','ðŸŒ»','ðŸ‰','ðŸ’š','ðŸ˜Ž'];

const styleFns=[
  t=>t,
  t=>t.toUpperCase(),
  t=>t.toLowerCase(),
  t=>mapChars(t,maps.bold),
  t=>mapChars(t,maps.italic),
  t=>mapChars(t,maps.smallCaps),
  t=>t.split('').reverse().join(''),
  t=>t.split('').join(' '),
  t=>`â™¡ ${t} â™¡`,
  t=>`â€ ${t} â€`,
  ...emojiList.map(e=>t=>`${e} ${t} ${e}`)
];

function renderStyles(){
  stylesList.innerHTML='';
  const val=inputEl.value||'';
  styleFns.forEach(fn=>{
    const div=document.createElement('div');
    div.className='style';
    div.textContent=fn(val);
    div.addEventListener('click', async ()=>{
      if(!currentUid){ alert('Login required.'); return; }
      try{
        const coinsRef=ref(db,'users/'+currentUid+'/coins');
        const tx=await runTransaction(coinsRef,cur=>{
          if(cur===null) return 0;
          if(cur>=2) return cur-2;
          return;
        });
        if(!tx.committed){ alert('Not enough coins'); return; }
        await navigator.clipboard.writeText(div.textContent);
        div.style.background='linear-gradient(90deg,#10b981,#06b6d4)';
        setTimeout(()=>div.style.background='var(--glass)',700);
        await refreshUser();
      }catch(err){ alert('Action failed'); console.error(err); }
    });
    stylesList.appendChild(div);
  });
}

inputEl.addEventListener('input', renderStyles);
renderStyles();
</script>
</body>
</html>
